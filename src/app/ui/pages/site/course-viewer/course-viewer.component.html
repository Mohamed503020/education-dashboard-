<div class="course-viewer" [class.sidebar-closed]="!sidebarOpen">
  <!-- Loading -->
  @if (loading) {
    <div class="loading-screen">
      <div class="spinner"></div>
      <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰...</p>
    </div>
  }

  @if (!loading && course) {
    <!-- Top Bar -->
    <div class="top-bar">
      <div class="top-bar-right">
        <button class="btn-icon" (click)="toggleSidebar()" title="Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©">
          <span>â˜°</span>
        </button>
        <a [routerLink]="['/site/course', course._id]" class="back-link">
          <span>â†’</span>
          <span class="course-title-bar">{{ course.title }}</span>
        </a>
      </div>
      <div class="top-bar-left">
        <div class="progress-info">
          <span class="progress-text">{{ activeIndex + 1 }} / {{ materials.length }}</span>
          <div class="progress-bar-mini">
            <div class="progress-fill" [style.width.%]="progressPercent"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="viewer-body">
      <!-- Sidebar -->
      <aside class="sidebar" [class.open]="sidebarOpen">
        <div class="sidebar-tabs">
          <button [class.active]="activeTab === 'lessons'" (click)="activeTab = 'lessons'">
            ğŸ“š Ø§Ù„Ù…Ø­ØªÙˆÙ‰
          </button>
          <button [class.active]="activeTab === 'exams'" (click)="activeTab = 'exams'">
            ğŸ“ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
          </button>
        </div>

        @if (activeTab === 'lessons') {
          <div class="materials-list">
            @for (material of materials; track material._id; let i = $index) {
              <div
                class="material-entry"
                [class.active]="activeMaterial?._id === material._id"
                [class.completed]="i < activeIndex"
                (click)="selectMaterial(material)"
              >
                <div class="entry-number">{{ i + 1 }}</div>
                <div class="entry-info">
                  <div class="entry-title">{{ material.title }}</div>
                  <div class="entry-meta">
                    <span class="entry-type">{{ getMaterialIcon(material.type) }} {{ getTypeName(material.type) }}</span>
                    @if (material.duration) {
                      <span class="entry-duration">{{ formatDuration(material.duration) }}</span>
                    }
                  </div>
                </div>
                @if (i < activeIndex) {
                  <span class="check-mark">âœ“</span>
                }
              </div>
            }

            @if (materials.length === 0) {
              <div class="empty-list">
                <span>ğŸ“­</span>
                <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹</p>
              </div>
            }
          </div>
        }

        @if (activeTab === 'exams') {
          <div class="exams-list">
            @for (exam of exams; track exam._id) {
              <a [routerLink]="['/site/exam', exam._id]" class="exam-entry">
                <span class="exam-icon">ğŸ“‹</span>
                <div class="exam-info">
                  <div class="exam-title">{{ exam.title }}</div>
                  <div class="exam-meta">
                    <span>{{ exam.questions.length || 0 }} Ø³Ø¤Ø§Ù„</span>
                    <span>{{ exam.timeLimit }} Ø¯Ù‚ÙŠÙ‚Ø©</span>
                  </div>
                </div>
              </a>
            }

            @if (exams.length === 0) {
              <div class="empty-list">
                <span>ğŸ“­</span>
                <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</p>
              </div>
            }
          </div>
        }
      </aside>

      <!-- Main Content -->
      <main class="content-area">
        @if (activeMaterial) {
          <!-- Video Player -->
          @if (activeMaterial.type === 'video') {
            <div class="video-wrapper">
              <video
                controls
                autoplay
                [src]="materialFileUrl"
                class="video-player"
                controlsList="nodownload"
              >
                Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
              </video>
            </div>
          }

          <!-- PDF Viewer -->
          @if (activeMaterial.type === 'pdf') {
            <div class="pdf-wrapper">
              <div class="pdf-toolbar">
                <span class="pdf-name">ğŸ“„ {{ activeMaterial.title }}</span>
                <button class="btn-download" (click)="downloadFile()">
                  â¬‡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
                </button>
              </div>
              <iframe
                [src]="safePdfUrl"
                class="pdf-viewer"
                type="application/pdf"
              ></iframe>
            </div>
          }

          <!-- Assignment / Document / Link -->
          @if (activeMaterial.type !== 'video' && activeMaterial.type !== 'pdf') {
            <div class="generic-content">
              <div class="content-icon">{{ getMaterialIcon(activeMaterial.type) }}</div>
              <h2>{{ activeMaterial.title }}</h2>
              @if (activeMaterial.description) {
                <p class="content-desc">{{ activeMaterial.description }}</p>
              }
              @if (activeMaterial.fileUrl) {
                <button class="btn-primary" (click)="downloadFile()">
                  â¬‡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
                </button>
              }
            </div>
          }

          <!-- Material Info Section -->
          <div class="material-info">
            <div class="info-header">
              <h2>{{ activeMaterial.title }}</h2>
              <span class="type-badge">{{ getTypeName(activeMaterial.type) }}</span>
            </div>
            @if (activeMaterial.description) {
              <p class="description">{{ activeMaterial.description }}</p>
            }
            <div class="teacher-info">
              <span>ğŸ‘¨â€ğŸ« {{ getTeacherName() }}</span>
            </div>
          </div>

          <!-- Navigation -->
          <div class="navigation-bar">
            <button
              class="nav-btn prev"
              [disabled]="!hasPrev"
              (click)="prevMaterial()"
            >
              <span>â†’</span> Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø³Ø§Ø¨Ù‚
            </button>
            <button
              class="nav-btn next"
              [disabled]="!hasNext"
              (click)="nextMaterial()"
            >
              Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„ØªØ§Ù„ÙŠ <span>â†</span>
            </button>
          </div>
        } @else {
          <!-- No material selected -->
          <div class="no-content">
            <div class="no-content-icon">ğŸ“š</div>
            <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ø¯ÙˆØ±Ø©</h2>
            <p>Ø§Ø®ØªØ± Ø¯Ø±Ø³Ø§Ù‹ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ù„Ù„Ø¨Ø¯Ø¡</p>
          </div>
        }
      </main>
    </div>
  }
</div>
