@if (loading) {
  <div class="loading-state" dir="rtl">
    <div class="spinner"></div>
    <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ±Ø³...</p>
  </div>
} @else if (course) {
  <div class="course-detail" dir="rtl">
    <!-- Course Header -->
    <section class="course-hero" [attr.data-stage]="course.stage">
      <div class="container">
        <div class="hero-grid">
          <div class="hero-info">
            @if (course.stage) {
              <span class="stage-badge">{{ getStageName(course.stage) }}</span>
            }
            <h1>{{ course.title }}</h1>
            <p class="course-desc">{{ course.description }}</p>
            <div class="course-meta">
              <div class="meta-item">
                <span class="meta-icon">ğŸ‘¨â€ğŸ«</span>
                <span>{{ getTeacherName() }}</span>
              </div>
              <div class="meta-item">
                <span class="meta-icon">ğŸ“–</span>
                <span>{{ course.materials.length || 0 }} Ø¯Ø±Ø³</span>
              </div>
              <div class="meta-item">
                <span class="meta-icon">ğŸ‘¥</span>
                <span>{{ course.enrollmentCount || 0 }} Ø·Ø§Ù„Ø¨ Ù…Ø³Ø¬Ù„</span>
              </div>
              @if (course.grade) {
                <div class="meta-item">
                  <span class="meta-icon">ğŸ«</span>
                  <span>{{ getGradeName(course.grade) }}</span>
                </div>
              }
            </div>
            <div class="hero-actions">
              @if (isEnrolled) {
                <a [routerLink]="['/site/learn', course._id]" class="btn btn-lg btn-primary">ğŸ¬ Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ¹Ù„Ù…</a>
                <span class="enrolled-badge">âœ… Ø£Ù†Øª Ù…Ø³Ø¬Ù„ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ±Ø³</span>
              } @else {
                <button class="btn btn-lg btn-accent" (click)="enroll()" [disabled]="enrolling">
                  {{ enrolling ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...' : 'Ø³Ø¬Ù‘Ù„ ÙÙŠ Ø§Ù„ÙƒÙˆØ±Ø³' }}
                </button>
              }
              <div class="price-tag">
                @if (course.isFree || course.price === 0) {
                  <span class="free">Ù…Ø¬Ø§Ù†ÙŠ</span>
                } @else {
                  <span>{{ course.price }} Ø¬Ù†ÙŠÙ‡</span>
                }
              </div>
            </div>
          </div>
          <div class="hero-thumb">
            @if (course.thumbnail) {
              <img [src]="course.thumbnail" [alt]="course.title">
            } @else {
              <div class="thumb-placeholder">ğŸ“š</div>
            }
          </div>
        </div>
      </div>
    </section>

    <!-- Content -->
    <section class="course-content">
      <div class="container">
        <div class="content-grid">
          <!-- Materials -->
          <div class="main-content">
            <div class="content-card">
              <h2>ğŸ“– Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙƒÙˆØ±Ø³</h2>
              @if (course.materials.length) {
                <div class="materials-list">
                  @for (material of course.materials; track material._id; let i = $index) {
                    <div class="material-item" [class.locked]="!isEnrolled">
                      <div class="material-num">{{ i + 1 }}</div>
                      <div class="material-info">
                        <h4>{{ material.title }}</h4>
                        @if (material.description) {
                          <p>{{ material.description }}</p>
                        }
                      </div>
                      <div class="material-type">
                        @switch (material.type) {
                          @case ('video') { <span>ğŸ¥</span> }
                          @case ('pdf') { <span>ğŸ“„</span> }
                          @case ('assignment') { <span>ğŸ“</span> }
                        }
                      </div>
                      @if (!isEnrolled) {
                        <span class="lock-icon">ğŸ”’</span>
                      }
                    </div>
                  }
                </div>
              } @else {
                <p class="empty-text">Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù‚Ø±ÙŠØ¨Ø§Ù‹</p>
              }
            </div>

            <!-- Exams -->
            @if (exams.length > 0) {
              <div class="content-card">
                <h2>ğŸ“ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</h2>
                <div class="exams-list">
                  @for (exam of exams; track exam._id) {
                    <div class="exam-item">
                      <div class="exam-info">
                        <h4>{{ exam.title }}</h4>
                        @if (exam.description) {
                          <p>{{ exam.description }}</p>
                        }
                        <div class="exam-meta">
                          <span>ğŸ“‹ {{ exam.questions.length || 0 }} Ø³Ø¤Ø§Ù„</span>
                          <span>â± {{ exam.timeLimit }} Ø¯Ù‚ÙŠÙ‚Ø©</span>
                          <span>âœ… Ø¯Ø±Ø¬Ø© Ø§Ù„Ù†Ø¬Ø§Ø­: {{ exam.passingScore }}%</span>
                        </div>
                      </div>
                      @if (isEnrolled) {
                        <a [routerLink]="['/site/exam', exam._id]" class="btn btn-sm btn-primary">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</a>
                      } @else {
                        <span class="lock-text">Ø³Ø¬Ù‘Ù„ Ø£ÙˆÙ„Ø§Ù‹</span>
                      }
                    </div>
                  }
                </div>
              </div>
            }
          </div>

          <!-- Sidebar -->
          <div class="side-content">
            <div class="info-card">
              <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙƒÙˆØ±Ø³</h3>
              <ul>
                @if (course.stage) {
                  <li><span>Ø§Ù„Ù…Ø±Ø­Ù„Ø©</span><span>{{ getStageName(course.stage) }}</span></li>
                }
                @if (course.grade) {
                  <li><span>Ø§Ù„ØµÙ</span><span>{{ getGradeName(course.grade) }}</span></li>
                }
                <li><span>Ø¹Ø¯Ø¯ Ø§Ù„Ø¯Ø±ÙˆØ³</span><span>{{ course.materials.length || 0 }}</span></li>
                <li><span>Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨</span><span>{{ course.enrollmentCount || 0 }}</span></li>
                @if (course.duration) {
                  <li><span>Ø§Ù„Ù…Ø¯Ø©</span><span>{{ course.duration }} Ø¯Ù‚ÙŠÙ‚Ø©</span></li>
                }
                @if (exams.length > 0) {
                  <li><span>Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</span><span>{{ exams.length }}</span></li>
                }
              </ul>
            </div>

            @if (!isEnrolled) {
              <div class="cta-card">
                <p>Ø³Ø¬Ù‘Ù„ ÙÙŠ Ø§Ù„ÙƒÙˆØ±Ø³ Ø§Ù„Ø¢Ù† ÙˆØ§Ø¨Ø¯Ø£ Ø§Ù„ØªØ¹Ù„Ù…</p>
                <button class="btn btn-accent btn-block" (click)="enroll()" [disabled]="enrolling">
                  {{ enrolling ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...' : 'Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¢Ù†' }}
                </button>
              </div>
            }
          </div>
        </div>
      </div>
    </section>
  </div>
}
